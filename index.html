<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOP calculator</title>
    <link rel="stylesheet" href="calc.css">
</head>
<body>
    <script>
        // Functions for the operations
        const add = (a, b) => a + b;
        const sub = (a, b) => a - b;
        const mul = (a, b) => a * b;
        const div = (a, b) => a / b;
        const operate = (opp, a, b) => {
            switch(opp){
                case '+':
                    return add(a, b);
                case '-':
                    return sub(a, b);
                case '*':
                    return mul(a, b);
                case '/':
                    return div(a, b);
            }
        }
        // main box
        const calculatorEl = document.createElement('div');
        calculatorEl.setAttribute('id', 'calculator');
        document.body.appendChild(calculatorEl);
        // display box
        const displayEl = document.createElement('div');
        displayEl.setAttribute('id', 'display');
        calculatorEl.appendChild(displayEl);
        // buttons box
        const btnContainer = document.createElement('div');
        btnContainer.setAttribute('id', 'buttonContainer');
        calculatorEl.appendChild(btnContainer);
        // symbols box
        const symbolsContainer = document.createElement('div');
        symbolsContainer.setAttribute('id', 'symbolsContainer');
        btnContainer.appendChild(symbolsContainer);
        // numbers box
        const numContainer = document.createElement('div');
        numContainer.setAttribute('id', 'numContainer');
        btnContainer.appendChild(numContainer);
        // symbols Array
        const symbolsArray = ['+', '-', '*', '/', '=', 'C', '<'];
        // create operator buttons and append to symbols box
        for(e of symbolsArray){
            let symbolButton = document.createElement('button');
            symbolButton.setAttribute('class', 'symbolButtons');
            symbolButton.setAttribute('id', `${e}`);
            symbolButton.textContent = `${e}`;
            symbolsContainer.appendChild(symbolButton);
        }
        let symbols = symbolsContainer.querySelectorAll('.symbolButtons')
        symbols.forEach(symbol => {
            if(symbol.id !== '=' && symbol.id !== 'C'){
                symbol.classList.add('operators')
            }
        });
        // create number buttons and append to numbers box
        for(i = 1; i < 10; i++){
            let numButton = document.createElement('button');
            numButton.setAttribute('class', 'numButtons');
            numButton.setAttribute('id', i);
            numButton.textContent = i;
            numContainer.appendChild(numButton);
        }
        let zeroButton = document.createElement('button');
        zeroButton.setAttribute('class', 'numButtons');
        zeroButton.setAttribute('id', '0');
        zeroButton.textContent = '0';
        numContainer.appendChild(zeroButton);
        let decimalButton = document.createElement('button');
        decimalButton.setAttribute('class', 'numButtons decimal');
        decimalButton.setAttribute('id', '.');
        decimalButton.textContent = '.';
        numContainer.appendChild(decimalButton);
        // Declare useful variables with initial values
        let displayValue = [];
        let firstNum = null;
        let operator = [];
        let secondNum = null;
        let operatorCount = 0;
        let firstOpDone = false;
        // function that resets variables
        function clear(){
            displayValue.length = 0;
            firstNum = null;
            operator.length = 0;
            secondNum = null;
            operatorCount = 0;
            firstOpDone = false;
        }
        // function that returns the result of displayed operation
        function equal(){
            console.log(operator);
            let oppIndex = displayValue.indexOf(operator[0]);
            if (oppIndex === -1){
                return
            }
            firstNum = displayValue.slice(0, oppIndex).join('');
            secondNum = displayValue.slice(oppIndex + 1).join('');
            let result = Math.round(operate(operator[0], +firstNum, +secondNum) * 10000) / 10000;
            clear();
            firstOpDone = true;
            displayValue.push(result);
        }
        // Get all buttons
        let calcButtons = btnContainer.querySelectorAll('button');
        // Add a click event listener for each button
        calcButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                switch(button.id){
                    case 'C':
                        clear();
                        break;
                    case '=':
                        equal();
                        break;
                    case '<':
                        if (displayValue.length === 1 && displayValue[0] !== 0){
                            console.log('case');
                            let num = displayValue[0].toString();
                            clear();
                            displayValue.push(Number(num.slice(0, -1)));
                            break;
                        } else {
                            let value = displayValue.slice(0, displayValue.length - 1);
                            clear();
                            displayValue = value;
                        }
                        break;
                    case '.':
                        console.log(firstNum);
                        console.log(displayValue);
                        let index = displayValue.indexOf(operator[0]);
                        console.log(index);
                        if (firstNum === null && displayValue.includes('.') || 
                            firstNum === null && displayValue.length !== 0 && displayValue[0].toString().includes('.') ||
                            firstNum !== null && displayValue.slice(index).includes('.')) {
                                return;
                        } else {
                            displayValue.push(button.id)
                        }
                        break; 
                    default:
                        if(displayValue[0] == 0 && displayValue.length === 1 && button.id !== '.'){
                            displayValue.length = 0;
                        }
                       displayValue.push(button.id);   
                }
                if (button.classList.contains('operators') && button.id !== '<') {
                    operatorCount++;
                    if(operatorCount > 1){
                        let oppIndex = displayValue.indexOf(operator[0]);
                        firstNum = displayValue.slice(0, oppIndex).join('');
                        secondNum = displayValue.slice(oppIndex + 1, displayValue.length - 1).join('');
                        let result = Math.round(operate(operator[0], +firstNum, +secondNum) * 10000) / 10000;
                        clear();
                        displayValue.push(result);
                        operatorCount = 1;
                        firstOpDone = true;
                        displayValue.push(button.id);
                    }
                    operator.push(button.id);
                    let oppIndex = displayValue.indexOf(button.id);
                    firstNum = displayValue.slice(0, oppIndex).join('');
                    
                }
                console.log(displayValue);
                displayEl.textContent = displayValue.join('');
            });
        });



    </script>
</body>
</html>